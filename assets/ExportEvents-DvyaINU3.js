import{r as p,c as j,j as e,s as _,d as O,f as F,m as N,A as U,i as s,P as $,T as n,E as y,B as D,a9 as M,aa as W,Y as z,ab as P}from"./index-DvtLfIyG.js";import{g as J,C as q,A as G,D as V}from"./Download-BF8nH-Lk.js";import{b as Y,S as H,B as T,L as K,a as Q,C as k}from"./CheckCircle-C8JchRhb.js";import{E as A}from"./Error-CkqpqGuI.js";import{L as X}from"./ListItemText-DDPY0Mna.js";const Z=a=>{const{alignItems:c,classes:i}=a;return F({root:["root",c==="flex-start"&&"alignItemsFlexStart"]},J,i)},ee=_("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(a,c)=>{const{ownerState:i}=a;return[c.root,i.alignItems==="flex-start"&&c.alignItemsFlexStart]}})(N(({theme:a})=>({minWidth:56,color:(a.vars||a).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),te=p.forwardRef(function(c,i){const l=j({props:c,name:"MuiListItemIcon"}),{className:h,...f}=l,m=p.useContext(Y),g={...l,alignItems:m.alignItems},S=Z(g);return e(ee,{className:O(S.root,h),ownerState:g,ref:i,...f})}),oe="economicEvents",R=["mql5","forex-factory","fxstreet"];function le(){const{user:a}=U(),[c,i]=p.useState(!1),[l,h]=p.useState(null),[f,m]=p.useState(null),g=async()=>{i(!0),m(null),h(null);try{console.log("ðŸ“Š Starting export of economic events from all sources...");const o=[];let x=0;for(const r of R){console.log(`ðŸ“¥ Exporting ${r}...`);const b=W(z,oe,r,"events"),I=await P(b),w=I.size;if(I.empty){console.warn(`âš ï¸ No events found for ${r}`),o.push({source:r,count:0,success:!1});continue}const E=I.docs.map(u=>{var d,C,L;const t=u.data();return{id:u.id,source:r,...t,date:(d=t.date)!=null&&d.toDate?{_seconds:Math.floor(t.date.toDate().getTime()/1e3),_nanoseconds:t.date.toDate().getTime()%1e3*1e6}:t.date,createdAt:(C=t.createdAt)!=null&&C.toDate?{_seconds:Math.floor(t.createdAt.toDate().getTime()/1e3),_nanoseconds:t.createdAt.toDate().getTime()%1e3*1e6}:t.createdAt,updatedAt:(L=t.updatedAt)!=null&&L.toDate?{_seconds:Math.floor(t.updatedAt.toDate().getTime()/1e3),_nanoseconds:t.updatedAt.toDate().getTime()%1e3*1e6}:t.updatedAt}});console.log(`âœ… Exported ${E.length} events from ${r}`),x+=E.length;const B=JSON.stringify(E,null,2),v=`${r}-events-${new Date().toISOString().split("T")[0]}.json`;try{const u=new Blob([B],{type:"application/json"}),t=URL.createObjectURL(u),d=document.createElement("a");d.href=t,d.download=v,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(t),o.push({source:r,count:w,success:!0,filename:v})}catch(u){console.error(`Failed to save ${v}:`,u),o.push({source:r,count:w,success:!1,filename:v})}}h({success:!0,sources:o,totalCount:x,timestamp:new Date().toISOString()})}catch(o){console.error("âŒ Export failed:",o),m(o.message||"Failed to export events")}finally{i(!1)}};return e(q,{maxWidth:"md",sx:{py:8},children:s($,{elevation:3,sx:{p:4},children:[s(H,{direction:"row",spacing:2,alignItems:"center",sx:{mb:4},children:[e(T,{variant:"outlined",startIcon:e(G,{}),onClick:()=>{window.location.hash="/"},sx:{minWidth:"auto"},children:"Back"}),e(n,{variant:"h4",component:"h1",sx:{flexGrow:1},children:"Export Economic Events"})]}),a&&e(y,{severity:"info",sx:{mb:3},children:s(n,{variant:"body2",children:["Logged in as: ",e("strong",{children:a.email})]})}),e(n,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Export economic events from all news sources to separate JSON files. This will download 3 files (one per source) containing all events with their metadata including dates, currencies, impact levels, and event details."}),s(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:[e("strong",{children:"Sources:"})," ",R.map(o=>o.toUpperCase()).join(", ")]}),e(D,{sx:{my:4},children:e(T,{variant:"contained",color:"primary",size:"large",startIcon:c?e(M,{size:20,color:"inherit"}):e(V,{}),onClick:g,disabled:c,fullWidth:!0,sx:{py:1.5},children:c?"Exporting All Sources...":"Export All Sources (3 Files)"})}),l&&s(y,{severity:"success",icon:e(k,{}),sx:{mb:2},children:[e(n,{variant:"subtitle2",gutterBottom:!0,children:"Export completed successfully!"}),s(n,{variant:"body2",sx:{mb:2},children:["Downloaded ",l.sources.filter(o=>o.success).length," files with ",l.totalCount.toLocaleString()," total events"]}),e(K,{dense:!0,sx:{bgcolor:"success.light",borderRadius:1,py:.5},children:l.sources.map(({source:o,count:x,success:r,filename:b})=>s(Q,{dense:!0,children:[e(te,{sx:{minWidth:36},children:r?e(k,{color:"success",fontSize:"small"}):e(A,{color:"error",fontSize:"small"})}),e(X,{primary:s(n,{variant:"body2",children:[s("strong",{children:[o.replace("-"," ").toUpperCase(),":"]})," ",x.toLocaleString()," events"]}),secondary:b||`${o}-events-${new Date(l.timestamp).toISOString().split("T")[0]}.json`})]},o))}),s(y,{severity:"info",sx:{mt:2},children:[e(n,{variant:"caption",display:"block",gutterBottom:!0,children:e("strong",{children:"ðŸ“¥ Files downloaded to your Downloads folder"})}),s(n,{variant:"caption",display:"block",children:["Move them to: ",e("code",{children:"D:\\Lofi Trades\\trading-clock\\data\\"})]})]})]}),f&&s(y,{severity:"error",icon:e(A,{}),onClose:()=>m(null),children:[e(n,{variant:"subtitle2",gutterBottom:!0,children:"Export failed"}),e(n,{variant:"body2",children:f})]}),s(D,{sx:{mt:4,p:2,bgcolor:"background.default",borderRadius:1},children:[e(n,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:e("strong",{children:"Export Details:"})}),s(n,{variant:"caption",color:"text.secondary",display:"block",sx:{ml:2},children:["â€¢ 3 files will be downloaded (one per source)",e("br",{}),"â€¢ Timestamps preserved in Firestore format (_seconds, _nanoseconds)",e("br",{}),"â€¢ Files automatically downloaded to your Downloads folder",e("br",{}),"â€¢ Move files to ",e("code",{children:"data/"})," folder to replace old exports",e("br",{}),"â€¢ File naming: ",s("code",{children:["{source}","-events-","{date}",".json"]})]})]})]})})}export{le as default};
