import{r as p,u as B,j as e,s as _,h as N,i as O,m as F,t as M,Q as U,q as s,P as z,X as n,$ as y,V as D,aj as $,G as W,N as P,aq as q}from"./index-C7hvWskH.js";import{C as H,A as V}from"./ArrowBack-Bmia9oCF.js";import{a as G,S as J,B as k,L as Q,C as T}from"./CheckCircle-40o3wHIf.js";import{L as X,a as K}from"./ListItemText-AwjuaLW2.js";import{g as Y}from"./listItemIconClasses--Fv7Npdf.js";import{E as A}from"./Error-BeEYJTUN.js";const Z=r=>{const{alignItems:a,classes:l}=r;return O({root:["root",a==="flex-start"&&"alignItemsFlexStart"]},Y,l)},ee=_("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:l}=r;return[a.root,l.alignItems==="flex-start"&&a.alignItemsFlexStart]}})(F(({theme:r})=>({minWidth:56,color:(r.vars||r).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),te=p.forwardRef(function(a,l){const c=B({props:a,name:"MuiListItemIcon"}),{className:h,...f}=c,m=p.useContext(G),g={...c,alignItems:m.alignItems},S=Z(g);return e(ee,{className:N(S.root,h),ownerState:g,ref:l,...f})}),oe=M(e("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),se="economicEvents",R=["mql5","forex-factory","fxstreet"];function de(){const{user:r}=U(),[a,l]=p.useState(!1),[c,h]=p.useState(null),[f,m]=p.useState(null),g=async()=>{l(!0),m(null),h(null);try{const o=[];let v=0;for(const i of R){const b=W(P,se,i,"events"),I=await q(b),w=I.size;if(I.empty){console.warn(`âš ï¸ No events found for ${i}`),o.push({source:i,count:0,success:!1});continue}const E=I.docs.map(u=>{var d,C,L;const t=u.data();return{id:u.id,source:i,...t,date:(d=t.date)!=null&&d.toDate?{_seconds:Math.floor(t.date.toDate().getTime()/1e3),_nanoseconds:t.date.toDate().getTime()%1e3*1e6}:t.date,createdAt:(C=t.createdAt)!=null&&C.toDate?{_seconds:Math.floor(t.createdAt.toDate().getTime()/1e3),_nanoseconds:t.createdAt.toDate().getTime()%1e3*1e6}:t.createdAt,updatedAt:(L=t.updatedAt)!=null&&L.toDate?{_seconds:Math.floor(t.updatedAt.toDate().getTime()/1e3),_nanoseconds:t.updatedAt.toDate().getTime()%1e3*1e6}:t.updatedAt}});v+=E.length;const j=JSON.stringify(E,null,2),x=`${i}-events-${new Date().toISOString().split("T")[0]}.json`;try{const u=new Blob([j],{type:"application/json"}),t=URL.createObjectURL(u),d=document.createElement("a");d.href=t,d.download=x,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(t),o.push({source:i,count:w,success:!0,filename:x})}catch(u){console.error(`Failed to save ${x}:`,u),o.push({source:i,count:w,success:!1,filename:x})}}h({success:!0,sources:o,totalCount:v,timestamp:new Date().toISOString()})}catch(o){console.error("âŒ Export failed:",o),m(o.message||"Failed to export events")}finally{l(!1)}};return e(H,{maxWidth:"md",sx:{py:8},children:s(z,{elevation:3,sx:{p:4},children:[s(J,{direction:"row",spacing:2,alignItems:"center",sx:{mb:4},children:[e(k,{variant:"outlined",startIcon:e(V,{}),onClick:()=>{window.location.hash="/"},sx:{minWidth:"auto"},children:"Back"}),e(n,{variant:"h4",component:"h1",sx:{flexGrow:1},children:"Export Economic Events"})]}),r&&e(y,{severity:"info",sx:{mb:3},children:s(n,{variant:"body2",children:["Logged in as: ",e("strong",{children:r.email})]})}),e(n,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Export economic events from all news sources to separate JSON files. This will download 3 files (one per source) containing all events with their metadata including dates, currencies, impact levels, and event details."}),s(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:[e("strong",{children:"Sources:"})," ",R.map(o=>o.toUpperCase()).join(", ")]}),e(D,{sx:{my:4},children:e(k,{variant:"contained",color:"primary",size:"large",startIcon:a?e($,{size:20,color:"inherit"}):e(oe,{}),onClick:g,disabled:a,fullWidth:!0,sx:{py:1.5},children:a?"Exporting All Sources...":"Export All Sources (3 Files)"})}),c&&s(y,{severity:"success",icon:e(T,{}),sx:{mb:2},children:[e(n,{variant:"subtitle2",gutterBottom:!0,children:"Export completed successfully!"}),s(n,{variant:"body2",sx:{mb:2},children:["Downloaded ",c.sources.filter(o=>o.success).length," files with ",c.totalCount.toLocaleString()," total events"]}),e(Q,{dense:!0,sx:{bgcolor:"success.light",borderRadius:1,py:.5},children:c.sources.map(({source:o,count:v,success:i,filename:b})=>s(X,{dense:!0,children:[e(te,{sx:{minWidth:36},children:i?e(T,{color:"success",fontSize:"small"}):e(A,{color:"error",fontSize:"small"})}),e(K,{primary:s(n,{variant:"body2",children:[s("strong",{children:[o.replace("-"," ").toUpperCase(),":"]})," ",v.toLocaleString()," events"]}),secondary:b||`${o}-events-${new Date(c.timestamp).toISOString().split("T")[0]}.json`})]},o))}),s(y,{severity:"info",sx:{mt:2},children:[e(n,{variant:"caption",display:"block",gutterBottom:!0,children:e("strong",{children:"ðŸ“¥ Files downloaded to your Downloads folder"})}),s(n,{variant:"caption",display:"block",children:["Move them to: ",e("code",{children:"D:\\Lofi Trades\\trading-clock\\data\\"})]})]})]}),f&&s(y,{severity:"error",icon:e(A,{}),onClose:()=>m(null),children:[e(n,{variant:"subtitle2",gutterBottom:!0,children:"Export failed"}),e(n,{variant:"body2",children:f})]}),s(D,{sx:{mt:4,p:2,bgcolor:"background.default",borderRadius:1},children:[e(n,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:e("strong",{children:"Export Details:"})}),s(n,{variant:"caption",color:"text.secondary",display:"block",sx:{ml:2},children:["â€¢ 3 files will be downloaded (one per source)",e("br",{}),"â€¢ Timestamps preserved in Firestore format (_seconds, _nanoseconds)",e("br",{}),"â€¢ Files automatically downloaded to your Downloads folder",e("br",{}),"â€¢ Move files to ",e("code",{children:"data/"})," folder to replace old exports",e("br",{}),"â€¢ File naming: ",s("code",{children:["{source}","-events-","{date}",".json"]})]})]})]})})}export{de as default};
