import{D as J,p as e,r,Q as i,v as s,P as S,w as o,V as m,a8 as T,a9 as w,a7 as G,ax as H,ay as X}from"./index-QNJSYLJn.js";import{p as Y,x as Z,L as ee,C as E}from"./TextField-CZuRRwHM.js";import{B as C,E as te,C as se,b as ae,a as re,S as oe}from"./Error-C9F-AQBt.js";import{L as ne}from"./ListItemText-C5BnhdTM.js";const ie=J(e("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"})),le=J(e("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),I="economicEventDescriptions";function ce(g){return g.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").substring(0,100)}function me(){const[g,_]=r.useState(!1),[F,P]=r.useState(""),[L,U]=r.useState(""),[n,A]=r.useState(null),[d,z]=r.useState(!1),[B,D]=r.useState(0),[f,v]=r.useState(null),[O,l]=r.useState(null),[u,x]=r.useState([]),M="9876543210",V=t=>{t.preventDefault(),F===M?(_(!0),U("")):(U("Incorrect password. Please try again."),P(""))},K=t=>{const a=t.target.files[0];a&&(a.type==="application/json"?(A(a),l(null),v(null),x([])):(l("Please select a valid JSON file"),A(null)))},Q=async()=>{if(!n){l("Please select a file first");return}z(!0),l(null),D(0),x([]);try{const t=await n.text(),a=JSON.parse(t);if(!a.events||!Array.isArray(a.events))throw new Error('Invalid JSON structure: missing "events" array');const b=a.events,k=b.length,W=[],$=T(w,I,"_metadata");await G($,{...a.metadata,uploadedAt:H(),uploadedBy:"admin",totalEvents:k});const j=500;let p=0;for(let h=0;h<b.length;h+=j){const N=X(w),R=b.slice(h,h+j);for(const c of R){const y=ce(c.name),q=T(w,I,y);N.set(q,{...c,docId:y,uploadedAt:H()},{merge:!0}),W.push({name:c.name,category:c.category,impact:c.impact,docId:y})}await N.commit(),p+=R.length,D(p/k*100)}x(W),v({success:!0,message:`Successfully uploaded ${p} event descriptions to Firestore`,count:p})}catch(t){console.error("Upload error:",t),l(t.message||"Failed to upload descriptions"),v({success:!1,message:"Upload failed"})}finally{z(!1)}};return g?e(i,{sx:{minHeight:"100vh",bgcolor:"background.default",p:4},children:s(S,{elevation:3,sx:{maxWidth:800,mx:"auto",p:4},children:[e(o,{variant:"h4",gutterBottom:!0,sx:{mb:3},children:"Upload Economic Event Descriptions"}),s(o,{variant:"body1",color:"text.secondary",sx:{mb:4},children:["Select the ",e("code",{children:"economicEventDescriptions.json"})," file to upload event descriptions to Firestore."]}),s(i,{sx:{mb:3},children:[e(Z,{type:"file",inputProps:{accept:".json"},onChange:K,sx:{display:"none"},id:"file-upload-input"}),e("label",{htmlFor:"file-upload-input",children:e(C,{variant:"outlined",component:"span",startIcon:e(ie,{}),disabled:d,fullWidth:!0,sx:{mb:2},children:"Select JSON File"})}),n&&s(m,{severity:"info",sx:{mb:2},children:["Selected: ",e("strong",{children:n.name})," (",(n.size/1024).toFixed(2)," KB)"]})]}),e(C,{variant:"contained",color:"primary",startIcon:e(le,{}),onClick:Q,disabled:!n||d,fullWidth:!0,sx:{mb:3},children:d?"Uploading...":"Upload to Firestore"}),d&&s(i,{sx:{mb:3},children:[e(ee,{variant:"determinate",value:B}),s(o,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:[Math.round(B),"% Complete"]})]}),O&&e(m,{severity:"error",icon:e(te,{}),sx:{mb:3},children:O}),f&&f.success&&e(m,{severity:"success",icon:e(se,{}),sx:{mb:3},children:f.message}),u.length>0&&s(i,{sx:{mt:4},children:[s(o,{variant:"h6",gutterBottom:!0,children:["Uploaded Events (",u.length,")"]}),e(S,{variant:"outlined",sx:{maxHeight:400,overflow:"auto",p:2},children:e(ae,{dense:!0,children:u.map((t,a)=>e(re,{divider:a<u.length-1,children:e(ne,{primary:t.name,secondary:s(oe,{direction:"row",spacing:1,sx:{mt:.5},children:[e(E,{label:t.category,size:"small",variant:"outlined"}),e(E,{label:t.impact,size:"small",color:t.impact==="high"?"error":t.impact==="medium"?"warning":"default"}),e(E,{label:t.docId,size:"small",variant:"outlined",sx:{fontFamily:"monospace",fontSize:"0.7rem"}})]})})},a))})})]}),s(i,{sx:{mt:4,p:2,bgcolor:"background.paper",borderRadius:1},children:[e(o,{variant:"subtitle2",gutterBottom:!0,children:"Instructions:"}),e(o,{variant:"body2",color:"text.secondary",component:"div",children:s("ol",{style:{margin:0,paddingLeft:20},children:[s("li",{children:['Click "Select JSON File" and choose ',e("code",{children:"economicEventDescriptions.json"})]}),e("li",{children:'Click "Upload to Firestore" to start the upload'}),e("li",{children:"Wait for the upload to complete"}),s("li",{children:["The events will be stored in the ",e("code",{children:I})," collection"]})]})})]})]})}):e(i,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:s(S,{elevation:3,sx:{maxWidth:400,width:"100%",p:4},children:[e(o,{variant:"h5",gutterBottom:!0,sx:{mb:3,textAlign:"center"},children:"Protected Page"}),e(o,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center"},children:"Please enter the password to access the upload page."}),s("form",{onSubmit:V,children:[e(Y,{type:"password",value:F,onChange:t=>P(t.target.value),placeholder:"Enter password",fullWidth:!0,autoFocus:!0,variant:"outlined",sx:{mb:2}}),L&&e(m,{severity:"error",sx:{mb:2},children:L}),e(C,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,children:"Submit"})]})]})})}export{me as default};
