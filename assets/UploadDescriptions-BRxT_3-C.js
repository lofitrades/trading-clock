import{r as d,i as Z,n as O,s as ee,o as te,w as n,p as e,v as s,q as se,ax as V,D as G,Q as x,P as W,V as A,a8 as K,a9 as j,a7 as oe,ay as Q,az as re}from"./index-Bo7EhqvM.js";import{L as ae,E as ne,p as D,q as ie,H as le,w as ce,C as de,z as pe}from"./TextField-DB_7VnqL.js";import{B as $,E as me,a as ue,S as he,C as H}from"./Error-CvFGQKhg.js";const ye=o=>{const{classes:a,inset:i,primary:h,secondary:g,dense:f}=o;return se({root:["root",i&&"inset",f&&"dense",h&&g&&"multiline"],primary:["primary"],secondary:["secondary"]},ne,a)},ge=ee("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(o,a)=>{const{ownerState:i}=o;return[{[`& .${D.primary}`]:a.primary},{[`& .${D.secondary}`]:a.secondary},a.root,i.inset&&a.inset,i.primary&&i.secondary&&a.multiline,i.dense&&a.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${V.root}:where(& .${D.primary})`]:{display:"block"},[`.${V.root}:where(& .${D.secondary})`]:{display:"block"},variants:[{props:({ownerState:o})=>o.primary&&o.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:o})=>o.inset,style:{paddingLeft:56}}]}),fe=d.forwardRef(function(a,i){const h=Z({props:a,name:"MuiListItemText"}),{children:g,className:f,disableTypography:l=!1,inset:I=!1,primary:y,primaryTypographyProps:E,secondary:T,secondaryTypographyProps:F,slots:b={},slotProps:S={},...L}=h,{dense:m}=d.useContext(ae);let c=y??g,p=T;const v={...h,disableTypography:l,inset:I,primary:!!c,secondary:!!p,dense:m},w=ye(v),C={slots:b,slotProps:{primary:E,secondary:F,...S}},[N,t]=O("root",{className:te(w.root,f),elementType:ge,externalForwardedProps:{...C,...L},ownerState:v,ref:i}),[r,u]=O("primary",{className:w.primary,elementType:n,externalForwardedProps:C,ownerState:v}),[U,z]=O("secondary",{className:w.secondary,elementType:n,externalForwardedProps:C,ownerState:v});return c!=null&&c.type!==n&&!l&&(c=e(r,{variant:m?"body2":"body1",component:u!=null&&u.variant?void 0:"span",...u,children:c})),p!=null&&p.type!==n&&!l&&(p=e(U,{variant:"body2",color:"textSecondary",...z,children:p})),s(N,{...t,children:[c,p]})}),ve=G(e("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"})),xe=G(e("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),M="economicEventDescriptions";function be(o){return o.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").substring(0,100)}function Pe(){const[o,a]=d.useState(!1),[i,h]=d.useState(""),[g,f]=d.useState(""),[l,I]=d.useState(null),[y,E]=d.useState(!1),[T,F]=d.useState(0),[b,S]=d.useState(null),[L,m]=d.useState(null),[c,p]=d.useState([]),v="9876543210",w=t=>{t.preventDefault(),i===v?(a(!0),f("")):(f("Incorrect password. Please try again."),h(""))},C=t=>{const r=t.target.files[0];r&&(r.type==="application/json"?(I(r),m(null),S(null),p([])):(m("Please select a valid JSON file"),I(null)))},N=async()=>{if(!l){m("Please select a file first");return}E(!0),m(null),F(0),p([]);try{const t=await l.text(),r=JSON.parse(t);if(!r.events||!Array.isArray(r.events))throw new Error('Invalid JSON structure: missing "events" array');const u=r.events,U=u.length,z=[],X=K(j,M,"_metadata");await oe(X,{...r.metadata,uploadedAt:Q(),uploadedBy:"admin",totalEvents:U});const J=500;let B=0;for(let R=0;R<u.length;R+=J){const _=re(j),q=u.slice(R,R+J);for(const P of q){const k=be(P.name),Y=K(j,M,k);_.set(Y,{...P,docId:k,uploadedAt:Q()},{merge:!0}),z.push({name:P.name,category:P.category,impact:P.impact,docId:k})}await _.commit(),B+=q.length,F(B/U*100)}p(z),S({success:!0,message:`Successfully uploaded ${B} event descriptions to Firestore`,count:B})}catch(t){console.error("Upload error:",t),m(t.message||"Failed to upload descriptions"),S({success:!1,message:"Upload failed"})}finally{E(!1)}};return o?e(x,{sx:{minHeight:"100vh",bgcolor:"background.default",p:4},children:s(W,{elevation:3,sx:{maxWidth:800,mx:"auto",p:4},children:[e(n,{variant:"h4",gutterBottom:!0,sx:{mb:3},children:"Upload Economic Event Descriptions"}),s(n,{variant:"body1",color:"text.secondary",sx:{mb:4},children:["Select the ",e("code",{children:"economicEventDescriptions.json"})," file to upload event descriptions to Firestore."]}),s(x,{sx:{mb:3},children:[e(le,{type:"file",inputProps:{accept:".json"},onChange:C,sx:{display:"none"},id:"file-upload-input"}),e("label",{htmlFor:"file-upload-input",children:e($,{variant:"outlined",component:"span",startIcon:e(ve,{}),disabled:y,fullWidth:!0,sx:{mb:2},children:"Select JSON File"})}),l&&s(A,{severity:"info",sx:{mb:2},children:["Selected: ",e("strong",{children:l.name})," (",(l.size/1024).toFixed(2)," KB)"]})]}),e($,{variant:"contained",color:"primary",startIcon:e(xe,{}),onClick:N,disabled:!l||y,fullWidth:!0,sx:{mb:3},children:y?"Uploading...":"Upload to Firestore"}),y&&s(x,{sx:{mb:3},children:[e(ce,{variant:"determinate",value:T}),s(n,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:[Math.round(T),"% Complete"]})]}),L&&e(A,{severity:"error",icon:e(me,{}),sx:{mb:3},children:L}),b&&b.success&&e(A,{severity:"success",icon:e(ue,{}),sx:{mb:3},children:b.message}),c.length>0&&s(x,{sx:{mt:4},children:[s(n,{variant:"h6",gutterBottom:!0,children:["Uploaded Events (",c.length,")"]}),e(W,{variant:"outlined",sx:{maxHeight:400,overflow:"auto",p:2},children:e(de,{dense:!0,children:c.map((t,r)=>e(pe,{divider:r<c.length-1,children:e(fe,{primary:t.name,secondary:s(he,{direction:"row",spacing:1,sx:{mt:.5},children:[e(H,{label:t.category,size:"small",variant:"outlined"}),e(H,{label:t.impact,size:"small",color:t.impact==="high"?"error":t.impact==="medium"?"warning":"default"}),e(H,{label:t.docId,size:"small",variant:"outlined",sx:{fontFamily:"monospace",fontSize:"0.7rem"}})]})})},r))})})]}),s(x,{sx:{mt:4,p:2,bgcolor:"background.paper",borderRadius:1},children:[e(n,{variant:"subtitle2",gutterBottom:!0,children:"Instructions:"}),e(n,{variant:"body2",color:"text.secondary",component:"div",children:s("ol",{style:{margin:0,paddingLeft:20},children:[s("li",{children:['Click "Select JSON File" and choose ',e("code",{children:"economicEventDescriptions.json"})]}),e("li",{children:'Click "Upload to Firestore" to start the upload'}),e("li",{children:"Wait for the upload to complete"}),s("li",{children:["The events will be stored in the ",e("code",{children:M})," collection"]})]})})]})]})}):e(x,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:s(W,{elevation:3,sx:{maxWidth:400,width:"100%",p:4},children:[e(n,{variant:"h5",gutterBottom:!0,sx:{mb:3,textAlign:"center"},children:"Protected Page"}),e(n,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center"},children:"Please enter the password to access the upload page."}),s("form",{onSubmit:w,children:[e(ie,{type:"password",value:i,onChange:t=>h(t.target.value),placeholder:"Enter password",fullWidth:!0,autoFocus:!0,variant:"outlined",sx:{mb:2}}),g&&e(A,{severity:"error",sx:{mb:2},children:g}),e($,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,children:"Submit"})]})]})})}export{Pe as default};
