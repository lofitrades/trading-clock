import{g as ue,a as pe,r as s,u as me,p as fe,k as o,s as F,j as r,c as be,b as m,d as he,m as A,e as L,ai as K,aj as X,l as ne,ak as ge,Q as f,U as c,P as E,X as x,Z as ve,F as te,J as N,H as ye,K as ae,al as xe}from"./index-5wZH95oK.js";import{T as Ce,I as Se,C as T}from"./TextField-CyNIe0j5.js";import{B as M,C as Pe,L as Ie,S as Le}from"./CheckCircle-dnyFUncK.js";import{E as ke}from"./Error-CW8ZTKEd.js";import{L as we,a as Be}from"./ListItemText-DqdI2hxJ.js";function $e(t){return ue("MuiLinearProgress",t)}pe("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","bar1","bar2","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const W=4,H=X`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`,Ee=typeof H!="string"?K`
        animation: ${H} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
      `:null,J=X`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`,Fe=typeof J!="string"?K`
        animation: ${J} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
      `:null,_=X`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`,Ae=typeof _!="string"?K`
        animation: ${_} 3s infinite linear;
      `:null,Ue=t=>{const{classes:e,variant:a,color:d}=t,C={root:["root",`color${m(d)}`,a],dashed:["dashed",`dashedColor${m(d)}`],bar1:["bar","bar1",`barColor${m(d)}`,(a==="indeterminate"||a==="query")&&"bar1Indeterminate",a==="determinate"&&"bar1Determinate",a==="buffer"&&"bar1Buffer"],bar2:["bar","bar2",a!=="buffer"&&`barColor${m(d)}`,a==="buffer"&&`color${m(d)}`,(a==="indeterminate"||a==="query")&&"bar2Indeterminate",a==="buffer"&&"bar2Buffer"]};return he(C,$e,e)},V=(t,e)=>t.vars?t.vars.palette.LinearProgress[`${e}Bg`]:t.palette.mode==="light"?t.lighten(t.palette[e].main,.62):t.darken(t.palette[e].main,.5),ze=F("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,e[`color${m(a.color)}`],e[a.variant]]}})(A(({theme:t})=>({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},variants:[...Object.entries(t.palette).filter(L()).map(([e])=>({props:{color:e},style:{backgroundColor:V(t,e)}})),{props:({ownerState:e})=>e.color==="inherit"&&e.variant!=="buffer",style:{"&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}}},{props:{variant:"buffer"},style:{backgroundColor:"transparent"}},{props:{variant:"query"},style:{transform:"rotate(180deg)"}}]}))),Oe=F("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.dashed,e[`dashedColor${m(a.color)}`]]}})(A(({theme:t})=>({position:"absolute",marginTop:0,height:"100%",width:"100%",backgroundSize:"10px 10px",backgroundPosition:"0 -23px",variants:[{props:{color:"inherit"},style:{opacity:.3,backgroundImage:"radial-gradient(currentColor 0%, currentColor 16%, transparent 42%)"}},...Object.entries(t.palette).filter(L()).map(([e])=>{const a=V(t,e);return{props:{color:e},style:{backgroundImage:`radial-gradient(${a} 0%, ${a} 16%, transparent 42%)`}}})]})),Ae||{animation:`${_} 3s infinite linear`}),Re=F("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.bar,e.bar1,e[`barColor${m(a.color)}`],(a.variant==="indeterminate"||a.variant==="query")&&e.bar1Indeterminate,a.variant==="determinate"&&e.bar1Determinate,a.variant==="buffer"&&e.bar1Buffer]}})(A(({theme:t})=>({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",variants:[{props:{color:"inherit"},style:{backgroundColor:"currentColor"}},...Object.entries(t.palette).filter(L()).map(([e])=>({props:{color:e},style:{backgroundColor:(t.vars||t).palette[e].main}})),{props:{variant:"determinate"},style:{transition:`transform .${W}s linear`}},{props:{variant:"buffer"},style:{zIndex:1,transition:`transform .${W}s linear`}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:{width:"auto"}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:Ee||{animation:`${H} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite`}}]}))),je=F("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.bar,e.bar2,e[`barColor${m(a.color)}`],(a.variant==="indeterminate"||a.variant==="query")&&e.bar2Indeterminate,a.variant==="buffer"&&e.bar2Buffer]}})(A(({theme:t})=>({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",variants:[...Object.entries(t.palette).filter(L()).map(([e])=>({props:{color:e},style:{"--LinearProgressBar2-barColor":(t.vars||t).palette[e].main}})),{props:({ownerState:e})=>e.variant!=="buffer"&&e.color!=="inherit",style:{backgroundColor:"var(--LinearProgressBar2-barColor, currentColor)"}},{props:({ownerState:e})=>e.variant!=="buffer"&&e.color==="inherit",style:{backgroundColor:"currentColor"}},{props:{color:"inherit"},style:{opacity:.3}},...Object.entries(t.palette).filter(L()).map(([e])=>({props:{color:e,variant:"buffer"},style:{backgroundColor:V(t,e),transition:`transform .${W}s linear`}})),{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:{width:"auto"}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:Fe||{animation:`${J} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite`}}]}))),De=s.forwardRef(function(e,a){const d=me({props:e,name:"MuiLinearProgress"}),{className:C,color:U="primary",value:y,valueBuffer:S,variant:p="indeterminate",...k}=d,l={...d,color:U,variant:p},b=Ue(l),h=fe(),g={},v={bar1:{},bar2:{}};if((p==="determinate"||p==="buffer")&&y!==void 0){g["aria-valuenow"]=Math.round(y),g["aria-valuemin"]=0,g["aria-valuemax"]=100;let u=y-100;h&&(u=-u),v.bar1.transform=`translateX(${u}%)`}if(p==="buffer"&&S!==void 0){let u=(S||0)-100;h&&(u=-u),v.bar2.transform=`translateX(${u}%)`}return o(ze,{className:be(b.root,C),ownerState:l,role:"progressbar",...g,ref:a,...k,children:[p==="buffer"?r(Oe,{className:b.dashed,ownerState:l}):null,r(Re,{className:b.bar1,ownerState:l,style:v.bar1}),p==="determinate"?null:r(je,{className:b.bar2,ownerState:l,style:v.bar2})]})}),Ne=ne(r("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"})),Te=ne(r("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),q="economicEventDescriptions";function Me(t){return t.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").substring(0,100)}function Ke(){const[t,e]=s.useState(null),[a,d]=s.useState(!0),[C,U]=s.useState(!1),[y,S]=s.useState(""),[p,k]=s.useState(""),[l,b]=s.useState(null),[h,g]=s.useState(!1),[v,u]=s.useState(0),[z,O]=s.useState(null),[Q,P]=s.useState(null),[w,R]=s.useState([]),oe="9876543210";s.useEffect(()=>{const n=ge(ve,i=>{e(i),d(!1)});return()=>n()},[]);const ie=n=>{n.preventDefault(),y===oe?(U(!0),k("")):(k("Incorrect password. Please try again."),S(""))},se=n=>{const i=n.target.files[0];i&&(i.type==="application/json"?(b(i),P(null),O(null),R([])):(P("Please select a valid JSON file"),b(null)))},le=async()=>{if(!l){P("Please select a file first");return}g(!0),P(null),u(0),R([]);try{const n=await l.text(),i=JSON.parse(n);if(!i.events||!Array.isArray(i.events))throw new Error('Invalid JSON structure: missing "events" array');const j=i.events,Y=j.length,Z=[],ce=te(N,q,"_metadata");await ye(ce,{...i.metadata,uploadedAt:ae(),uploadedBy:"admin",totalEvents:Y});const G=500;let B=0;for(let $=0;$<j.length;$+=G){const ee=xe(N),re=j.slice($,$+G);for(const I of re){const D=Me(I.name),de=te(N,q,D);ee.set(de,{...I,docId:D,uploadedAt:ae()},{merge:!0}),Z.push({name:I.name,category:I.category,impact:I.impact,docId:D})}await ee.commit(),B+=re.length,u(B/Y*100)}R(Z),O({success:!0,message:`Successfully uploaded ${B} event descriptions to Firestore`,count:B})}catch(n){console.error("Upload error:",n),P(n.message||"Failed to upload descriptions"),O({success:!1,message:"Upload failed"})}finally{g(!1)}};return a?r(f,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center"},children:r(c,{children:"Loading..."})}):t?C?r(f,{sx:{minHeight:"100vh",bgcolor:"background.default",p:4},children:o(E,{elevation:3,sx:{maxWidth:800,mx:"auto",p:4},children:[r(c,{variant:"h4",gutterBottom:!0,sx:{mb:3},children:"Upload Economic Event Descriptions"}),o(c,{variant:"body1",color:"text.secondary",sx:{mb:4},children:["Select the ",r("code",{children:"economicEventDescriptions.json"})," file to upload event descriptions to Firestore."]}),o(f,{sx:{mb:3},children:[r(Se,{type:"file",inputProps:{accept:".json"},onChange:se,sx:{display:"none"},id:"file-upload-input"}),r("label",{htmlFor:"file-upload-input",children:r(M,{variant:"outlined",component:"span",startIcon:r(Ne,{}),disabled:h,fullWidth:!0,sx:{mb:2},children:"Select JSON File"})}),l&&o(x,{severity:"info",sx:{mb:2},children:["Selected: ",r("strong",{children:l.name})," (",(l.size/1024).toFixed(2)," KB)"]})]}),r(M,{variant:"contained",color:"primary",startIcon:r(Te,{}),onClick:le,disabled:!l||h,fullWidth:!0,sx:{mb:3},children:h?"Uploading...":"Upload to Firestore"}),h&&o(f,{sx:{mb:3},children:[r(De,{variant:"determinate",value:v}),o(c,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:[Math.round(v),"% Complete"]})]}),Q&&r(x,{severity:"error",icon:r(ke,{}),sx:{mb:3},children:Q}),z&&z.success&&r(x,{severity:"success",icon:r(Pe,{}),sx:{mb:3},children:z.message}),w.length>0&&o(f,{sx:{mt:4},children:[o(c,{variant:"h6",gutterBottom:!0,children:["Uploaded Events (",w.length,")"]}),r(E,{variant:"outlined",sx:{maxHeight:400,overflow:"auto",p:2},children:r(Ie,{dense:!0,children:w.map((n,i)=>r(we,{divider:i<w.length-1,children:r(Be,{primary:n.name,secondary:o(Le,{direction:"row",spacing:1,sx:{mt:.5},children:[r(T,{label:n.category,size:"small",variant:"outlined"}),r(T,{label:n.impact,size:"small",color:n.impact==="high"?"error":n.impact==="medium"?"warning":"default"}),r(T,{label:n.docId,size:"small",variant:"outlined",sx:{fontFamily:"monospace",fontSize:"0.7rem"}})]})})},i))})})]}),o(f,{sx:{mt:4,p:2,bgcolor:"background.paper",borderRadius:1},children:[r(c,{variant:"subtitle2",gutterBottom:!0,children:"Instructions:"}),r(c,{variant:"body2",color:"text.secondary",component:"div",children:o("ol",{style:{margin:0,paddingLeft:20},children:[o("li",{children:['Click "Select JSON File" and choose ',r("code",{children:"economicEventDescriptions.json"})]}),r("li",{children:'Click "Upload to Firestore" to start the upload'}),r("li",{children:"Wait for the upload to complete"}),o("li",{children:["The events will be stored in the ",r("code",{children:q})," collection"]})]})})]})]})}):r(f,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:o(E,{elevation:3,sx:{maxWidth:400,width:"100%",p:4},children:[o(x,{severity:"info",sx:{mb:3},children:["Logged in as: ",t.email]}),r(c,{variant:"h5",gutterBottom:!0,sx:{mb:3,textAlign:"center"},children:"Protected Page"}),r(c,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center"},children:"Please enter the password to access the upload page."}),o("form",{onSubmit:ie,children:[r(Ce,{type:"password",value:y,onChange:n=>S(n.target.value),placeholder:"Enter password",fullWidth:!0,autoFocus:!0,variant:"outlined",sx:{mb:2}}),p&&r(x,{severity:"error",sx:{mb:2},children:p}),r(M,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,children:"Submit"})]})]})}):r(f,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:o(E,{elevation:3,sx:{maxWidth:500,width:"100%",p:4},children:[r(x,{severity:"error",sx:{mb:2},children:"You must be logged in to Firebase Authentication to upload event descriptions."}),r(c,{variant:"body2",color:"text.secondary",children:"Please log in to your Firebase account first, then return to this page."}),o(c,{variant:"body2",color:"text.secondary",sx:{mt:2},children:["Current auth state: ",t?"Logged in":"Not logged in"]})]})})}export{Ke as default};
