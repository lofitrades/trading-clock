import{k as J,j as e,r as o,B as i,i as s,P as S,T as a,E as m,X as R,Y as E,W as q,a5 as H,a6 as G}from"./index-DvtLfIyG.js";import{T as Q,I as Z,C as w}from"./TextField-DyXy0XqW.js";import{B as I,C as ee,L as te,a as se,S as re}from"./CheckCircle-C8JchRhb.js";import{L as oe}from"./LinearProgress-C-XeIosa.js";import{E as ae}from"./Error-CkqpqGuI.js";import{L as ne}from"./ListItemText-DDPY0Mna.js";const ie=J(e("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"})),le=J(e("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),C="economicEventDescriptions";function ce(g){return g.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").substring(0,100)}function fe(){const[g,_]=o.useState(!1),[F,P]=o.useState(""),[L,U]=o.useState(""),[n,A]=o.useState(null),[d,B]=o.useState(!1),[z,k]=o.useState(0),[f,v]=o.useState(null),[D,l]=o.useState(null),[u,x]=o.useState([]),M="9876543210",K=t=>{t.preventDefault(),F===M?(_(!0),U("")):(U("Incorrect password. Please try again."),P(""))},V=t=>{const r=t.target.files[0];r&&(r.type==="application/json"?(A(r),l(null),v(null),x([])):(l("Please select a valid JSON file"),A(null)))},X=async()=>{if(!n){l("Please select a file first");return}B(!0),l(null),k(0),x([]);try{const t=await n.text(),r=JSON.parse(t);if(!r.events||!Array.isArray(r.events))throw new Error('Invalid JSON structure: missing "events" array');const b=r.events,O=b.length,T=[],Y=R(E,C,"_metadata");await q(Y,{...r.metadata,uploadedAt:H(),uploadedBy:"admin",totalEvents:O});const W=500;let p=0;for(let h=0;h<b.length;h+=W){const j=G(E),N=b.slice(h,h+W);for(const c of N){const y=ce(c.name),$=R(E,C,y);j.set($,{...c,docId:y,uploadedAt:H()},{merge:!0}),T.push({name:c.name,category:c.category,impact:c.impact,docId:y})}await j.commit(),p+=N.length,k(p/O*100)}x(T),v({success:!0,message:`Successfully uploaded ${p} event descriptions to Firestore`,count:p})}catch(t){console.error("Upload error:",t),l(t.message||"Failed to upload descriptions"),v({success:!1,message:"Upload failed"})}finally{B(!1)}};return g?e(i,{sx:{minHeight:"100vh",bgcolor:"background.default",p:4},children:s(S,{elevation:3,sx:{maxWidth:800,mx:"auto",p:4},children:[e(a,{variant:"h4",gutterBottom:!0,sx:{mb:3},children:"Upload Economic Event Descriptions"}),s(a,{variant:"body1",color:"text.secondary",sx:{mb:4},children:["Select the ",e("code",{children:"economicEventDescriptions.json"})," file to upload event descriptions to Firestore."]}),s(i,{sx:{mb:3},children:[e(Z,{type:"file",inputProps:{accept:".json"},onChange:V,sx:{display:"none"},id:"file-upload-input"}),e("label",{htmlFor:"file-upload-input",children:e(I,{variant:"outlined",component:"span",startIcon:e(ie,{}),disabled:d,fullWidth:!0,sx:{mb:2},children:"Select JSON File"})}),n&&s(m,{severity:"info",sx:{mb:2},children:["Selected: ",e("strong",{children:n.name})," (",(n.size/1024).toFixed(2)," KB)"]})]}),e(I,{variant:"contained",color:"primary",startIcon:e(le,{}),onClick:X,disabled:!n||d,fullWidth:!0,sx:{mb:3},children:d?"Uploading...":"Upload to Firestore"}),d&&s(i,{sx:{mb:3},children:[e(oe,{variant:"determinate",value:z}),s(a,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:[Math.round(z),"% Complete"]})]}),D&&e(m,{severity:"error",icon:e(ae,{}),sx:{mb:3},children:D}),f&&f.success&&e(m,{severity:"success",icon:e(ee,{}),sx:{mb:3},children:f.message}),u.length>0&&s(i,{sx:{mt:4},children:[s(a,{variant:"h6",gutterBottom:!0,children:["Uploaded Events (",u.length,")"]}),e(S,{variant:"outlined",sx:{maxHeight:400,overflow:"auto",p:2},children:e(te,{dense:!0,children:u.map((t,r)=>e(se,{divider:r<u.length-1,children:e(ne,{primary:t.name,secondary:s(re,{direction:"row",spacing:1,sx:{mt:.5},children:[e(w,{label:t.category,size:"small",variant:"outlined"}),e(w,{label:t.impact,size:"small",color:t.impact==="high"?"error":t.impact==="medium"?"warning":"default"}),e(w,{label:t.docId,size:"small",variant:"outlined",sx:{fontFamily:"monospace",fontSize:"0.7rem"}})]})})},r))})})]}),s(i,{sx:{mt:4,p:2,bgcolor:"background.paper",borderRadius:1},children:[e(a,{variant:"subtitle2",gutterBottom:!0,children:"Instructions:"}),e(a,{variant:"body2",color:"text.secondary",component:"div",children:s("ol",{style:{margin:0,paddingLeft:20},children:[s("li",{children:['Click "Select JSON File" and choose ',e("code",{children:"economicEventDescriptions.json"})]}),e("li",{children:'Click "Upload to Firestore" to start the upload'}),e("li",{children:"Wait for the upload to complete"}),s("li",{children:["The events will be stored in the ",e("code",{children:C})," collection"]})]})})]})]})}):e(i,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:s(S,{elevation:3,sx:{maxWidth:400,width:"100%",p:4},children:[e(a,{variant:"h5",gutterBottom:!0,sx:{mb:3,textAlign:"center"},children:"Protected Page"}),e(a,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center"},children:"Please enter the password to access the upload page."}),s("form",{onSubmit:K,children:[e(Q,{type:"password",value:F,onChange:t=>P(t.target.value),placeholder:"Enter password",fullWidth:!0,autoFocus:!0,variant:"outlined",sx:{mb:2}}),L&&e(m,{severity:"error",sx:{mb:2},children:L}),e(I,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,children:"Submit"})]})]})})}export{fe as default};
