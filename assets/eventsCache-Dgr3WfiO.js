import{a8 as l,a9 as u,as as g}from"./index-CKgUHhcZ.js";const o="t2t_economic_events_cache",s="t2t_events_cache_metadata",d="1.0.0",f=24;function r(){try{const e=localStorage.getItem(s);if(!e)return null;const t=JSON.parse(e);return t.version!==d?(console.log("ğŸ“¦ Cache version mismatch, invalidating..."),m(),null):t}catch(e){return console.error("âŒ Error reading cache metadata:",e),null}}function h(){try{const e=localStorage.getItem(o);return e?JSON.parse(e):null}catch(e){return console.error("âŒ Error reading cached events:",e),null}}function m(){console.log("ğŸ—‘ï¸ Invalidating events cache"),localStorage.removeItem(o),localStorage.removeItem(s)}async function C(){const e=r();if(!e)return!1;const a=Date.now()-e.cachedAt,n=f*60*60*1e3;if(a>n)return console.log("â° Cache expired (age-based)"),!1;try{const c=await y();return c&&c>e.lastSyncAt?(console.log("ğŸ”„ API sync occurred after cache, invalidating"),!1):!0}catch(c){return console.error("âŒ Error checking sync status:",c),a<=n}}async function y(){try{const e=l(u,"systemJobs","economicEventsCalendarSync"),t=await g(e);if(!t.exists())return null;const n=t.data().lastRun;return n?n.toMillis?n.toMillis():n.seconds*1e3:null}catch(e){return e.code==="permission-denied"?(console.log("âš ï¸ Cannot read sync status (not authenticated), using cache age fallback"),null):(console.error("âŒ Error fetching sync status:",e),null)}}async function v(){return console.log("ğŸ“¡ Fetching all events from Firestore..."),console.warn("âš ï¸ Cache temporarily disabled - multi-source structure migration in progress"),[]}async function i(e=!1){if(!e&&await C()){const t=h();if(t)return console.log(`ğŸ“¦ Using cached events (${t.length} events)`),t}return await v()}async function A(){const e=r();if(e&&e.currencies)return e.currencies;await i();const t=r();return(t==null?void 0:t.currencies)||[]}async function S(){const e=r();if(e&&e.categories)return e.categories;await i();const t=r();return(t==null?void 0:t.categories)||[]}export{i as getAllEvents,S as getCachedCategories,A as getCachedCurrencies,m as invalidateCache};
