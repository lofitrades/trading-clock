{
  "__fileHeader": {
    "path": "firebase.json",
    "purpose": "Firebase Hosting and Functions configuration for Time 2 Trade frontend/backend deployment.",
    "changelog": [
      "v1.12.0 - 2026-02-05 - BEP SEO FIX: Added explicit Content-Type headers for all sitemap files (sitemap-pages.xml, sitemap-events.xml, sitemap-blog.xml). Browsers were displaying plain text instead of XML because static files lacked Content-Type: application/xml header. Cloud Functions already set headers correctly, but static hosting needed explicit config.",
      "v1.11.0 - 2026-02-05 - BEP SEO SOCIAL: Fixed blog post sharing. /blog/* now routes to serveBlogHtml Cloud Function for pre-rendered HTML with OG meta tags. Social media crawlers (WhatsApp, Facebook, Twitter) will now see post-specific thumbnails, titles, and descriptions.",
      "v1.10.0 - 2026-02-04 - BEP SITEMAP: Added dynamic sitemap rewrites. /sitemap.xml → serveSitemapIndex, /sitemap-blog.xml → serveSitemapBlog. Static sitemap-pages.xml and sitemap-events.xml served directly. Enables auto-update of blog sitemap on publish.",
      "v1.9.0 - 2026-02-04 - BEP BLOG: Added /blog{,/**} and /{lang}/blog{,/**} rewrites for blog SPA routing. Pre-rendered HTML is served via Cloud Function for SEO.",
      "v1.8.0 - 2026-02-02 - BEP SEO REDIRECT FIX: Added explicit /index.html rewrites for all pages and language variants to prevent 301 redirects. With cleanUrls: true, Firebase was redirecting /page/index.html → /page. Now all direct file requests return 200 OK. Covers 21 rewrites: 7 EN pages + 7 ES pages + 7 FR pages. Added /events pattern rewrites for all 3 languages to fallback to /calendar when event static files don't exist (proper SPA behavior). Eliminates redirect waste and improves crawl efficiency.",
      "v1.7.0 - 2026-02-02 - BEP SEO CRITICAL: Added trailingSlash: false and cleanUrls: true to eliminate 301 redirects. Google Search Console was reporting 'Page with redirect' errors for /about and other pages because Firebase was auto-redirecting /about → /about/. cleanUrls allows serving /about/index.html at /about without redirects. trailingSlash: false prevents enforcing trailing slashes. Also added explicit EN rewrites for /clock, /calendar, /about, /privacy, /terms, /contact to match ES/FR patterns. Fixes Google indexing issues.",
      "v1.6.0 - 2026-01-30 - BEP SEO FIX: Reverted rewrites to simple '**' catch-all pattern. Firebase Hosting serves exact-match static files (ads.txt, robots.txt, sitemap.xml) BEFORE processing rewrites per official priority order. The negation pattern was unnecessary and non-standard. Static files in dist/ are automatically served at step 3, rewrites only apply when files don't exist (step 4). This follows Firebase Hosting BEP and ensures ads.txt is crawlable by Google AdSense.",
      "v1.5.0 - 2026-01-28 - BEP FIX: Rewrites now serve prerendered subpages (/es/contact, /fr/about, etc.) correctly. Each language route pattern serves its own index.html, enabling SEO for all localized pages.",
      "v1.4.0 - 2026-01-27 - BEP ENHANCED i18n: Added rewrites for /es/* and /fr/* language subpaths. Multi-language prerendered HTML files now serve with proper language parameter. Enables non-JS crawlers to see localized content immediately.",
      "v1.3.0 - 2026-01-27 - BEP CONSOLE FIX: Added Cross-Origin-Opener-Policy: unsafe-none header to all responses. Fixes Firebase Auth SDK warning 'COOP policy would block window.closed call'. Firebase popup auth needs to check window.closed from auth popup window, which COOP: same-origin policy would block.",
      "v1.2.0 - 2025-12-17 - Added static file headers for robots.txt and sitemap.xml for SEO.",
      "v1.1.0 - 2025-12-16 - Added immutable cache headers for JS/CSS and retained SPA rewrite for custom domain hosting.",
      "v1.0.0 - 2025-12-16 - Initial configuration with hosting, functions, emulators, firestore, and storage settings."
    ]
  },
  "hosting": {
    "public": "dist",
    "trailingSlash": false,
    "cleanUrls": true,
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "__comment": "Dynamic sitemaps - served by Cloud Functions",
        "source": "/sitemap.xml",
        "function": "serveSitemapIndex"
      },
      {
        "source": "/sitemap-blog.xml",
        "function": "serveSitemapBlog"
      },
      {
        "source": "/index.html",
        "destination": "/index.html"
      },
      {
        "source": "/clock/index.html",
        "destination": "/clock/index.html"
      },
      {
        "source": "/calendar/index.html",
        "destination": "/calendar/index.html"
      },
      {
        "source": "/about/index.html",
        "destination": "/about/index.html"
      },
      {
        "source": "/privacy/index.html",
        "destination": "/privacy/index.html"
      },
      {
        "source": "/terms/index.html",
        "destination": "/terms/index.html"
      },
      {
        "source": "/contact/index.html",
        "destination": "/contact/index.html"
      },
      {
        "source": "/es/index.html",
        "destination": "/es/index.html"
      },
      {
        "source": "/es/clock/index.html",
        "destination": "/es/clock/index.html"
      },
      {
        "source": "/es/calendar/index.html",
        "destination": "/es/calendar/index.html"
      },
      {
        "source": "/es/about/index.html",
        "destination": "/es/about/index.html"
      },
      {
        "source": "/es/privacy/index.html",
        "destination": "/es/privacy/index.html"
      },
      {
        "source": "/es/terms/index.html",
        "destination": "/es/terms/index.html"
      },
      {
        "source": "/es/contact/index.html",
        "destination": "/es/contact/index.html"
      },
      {
        "source": "/fr/index.html",
        "destination": "/fr/index.html"
      },
      {
        "source": "/fr/clock/index.html",
        "destination": "/fr/clock/index.html"
      },
      {
        "source": "/fr/calendar/index.html",
        "destination": "/fr/calendar/index.html"
      },
      {
        "source": "/fr/about/index.html",
        "destination": "/fr/about/index.html"
      },
      {
        "source": "/fr/privacy/index.html",
        "destination": "/fr/privacy/index.html"
      },
      {
        "source": "/fr/terms/index.html",
        "destination": "/fr/terms/index.html"
      },
      {
        "source": "/fr/contact/index.html",
        "destination": "/fr/contact/index.html"
      },
      {
        "source": "/clock{,/**}",
        "destination": "/clock/index.html"
      },
      {
        "source": "/calendar{,/**}",
        "destination": "/calendar/index.html"
      },
      {
        "source": "/about{,/**}",
        "destination": "/about/index.html"
      },
      {
        "source": "/privacy{,/**}",
        "destination": "/privacy/index.html"
      },
      {
        "source": "/terms{,/**}",
        "destination": "/terms/index.html"
      },
      {
        "source": "/contact{,/**}",
        "destination": "/contact/index.html"
      },
      {
        "source": "/events{,/**}",
        "destination": "/calendar/index.html"
      },
      {
        "source": "/es/clock{,/**}",
        "destination": "/es/clock/index.html"
      },
      {
        "source": "/es/calendar{,/**}",
        "destination": "/es/calendar/index.html"
      },
      {
        "source": "/es/about{,/**}",
        "destination": "/es/about/index.html"
      },
      {
        "source": "/es/privacy{,/**}",
        "destination": "/es/privacy/index.html"
      },
      {
        "source": "/es/terms{,/**}",
        "destination": "/es/terms/index.html"
      },
      {
        "source": "/es/contact{,/**}",
        "destination": "/es/contact/index.html"
      },
      {
        "source": "/es/events{,/**}",
        "destination": "/es/calendar/index.html"
      },
      {
        "source": "/es{,/**}",
        "destination": "/es/index.html"
      },
      {
        "source": "/fr/clock{,/**}",
        "destination": "/fr/clock/index.html"
      },
      {
        "source": "/fr/calendar{,/**}",
        "destination": "/fr/calendar/index.html"
      },
      {
        "source": "/fr/about{,/**}",
        "destination": "/fr/about/index.html"
      },
      {
        "source": "/fr/privacy{,/**}",
        "destination": "/fr/privacy/index.html"
      },
      {
        "source": "/fr/terms{,/**}",
        "destination": "/fr/terms/index.html"
      },
      {
        "source": "/fr/contact{,/**}",
        "destination": "/fr/contact/index.html"
      },
      {
        "source": "/fr/events{,/**}",
        "destination": "/fr/calendar/index.html"
      },
      {
        "source": "/fr{,/**}",
        "destination": "/fr/index.html"
      },
      {
        "__comment": "Blog routes - serve SPA for client-side routing. Pre-rendered HTML for bots handled via Cloud Function with bot detection.",
        "source": "/blog{,/**}",
        "function": "serveBlogHtml"
      },
      {
        "source": "/es/blog{,/**}",
        "function": "serveBlogHtml"
      },
      {
        "source": "/fr/blog{,/**}",
        "function": "serveBlogHtml"
      },
      {
        "source": "**",
        "destination": "/index.html"
      }
    ],
    "headers": [
      {
        "source": "**/*.@(js|css)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "public, max-age=31536000, immutable"
          }
        ]
      },
      {
        "source": "robots.txt",
        "headers": [
          {
            "key": "Content-Type",
            "value": "text/plain"
          },
          {
            "key": "Cache-Control",
            "value": "public, max-age=86400"
          }
        ]
      },
      {
        "source": "sitemap.xml",
        "headers": [
          {
            "key": "Content-Type",
            "value": "application/xml; charset=utf-8"
          },
          {
            "key": "Cache-Control",
            "value": "public, max-age=86400"
          }
        ]
      },
      {
        "source": "sitemap-pages.xml",
        "headers": [
          {
            "key": "Content-Type",
            "value": "application/xml; charset=utf-8"
          },
          {
            "key": "Cache-Control",
            "value": "public, max-age=86400"
          }
        ]
      },
      {
        "source": "sitemap-events.xml",
        "headers": [
          {
            "key": "Content-Type",
            "value": "application/xml; charset=utf-8"
          },
          {
            "key": "Cache-Control",
            "value": "public, max-age=86400"
          }
        ]
      },
      {
        "source": "sitemap-blog.xml",
        "headers": [
          {
            "key": "Content-Type",
            "value": "application/xml; charset=utf-8"
          },
          {
            "key": "Cache-Control",
            "value": "public, max-age=3600"
          }
        ]
      },
      {
        "source": "sitemap.xsl",
        "headers": [
          {
            "key": "Content-Type",
            "value": "application/xslt+xml; charset=utf-8"
          },
          {
            "key": "Cache-Control",
            "value": "public, max-age=86400"
          }
        ]
      },
      {
        "source": "ads.txt",
        "headers": [
          {
            "key": "Content-Type",
            "value": "text/plain"
          },
          {
            "key": "Cache-Control",
            "value": "public, max-age=86400"
          }
        ]
      },
      {
        "source": "**",
        "headers": [
          {
            "key": "Cross-Origin-Opener-Policy",
            "value": "unsafe-none"
          }
        ]
      }
    ]
  },
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "disallowLegacyRuntimeConfig": true,
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log",
        "*.local"
      ],
      "predeploy": [
        "npm --prefix \"$RESOURCE_DIR\" run build"
      ]
    }
  ],
  "emulators": {
    "functions": {
      "port": 5001
    },
    "firestore": {
      "port": 8080
    },
    "ui": {
      "enabled": true,
      "port": 4000
    }
  },
  "firestore": {
    "database": "(default)",
    "location": "us-central1",
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "storage": {
    "rules": "storage.rules"
  }
}
